# Environment Properties Manager ユーザーマニュアル

## 目次
1. [概要](#概要)
2. [初期設定](#初期設定)
3. [基本機能](#基本機能)
   - [プロパティの編集](#プロパティの編集)
   - [プロパティの追加](#プロパティの追加)
   - [環境の追加](#環境の追加)
   - [環境の削除](#環境の削除)
   - [変更の保存とキャンセル](#変更の保存とキャンセル)
4. [フィルタリング機能](#フィルタリング機能)
   - [コンポーネント切り替え](#コンポーネント切り替え)
   - [キーフィルター](#キーフィルター)
5. [データ管理機能](#データ管理機能)
   - [フォルダからの初期化](#フォルダからの初期化)
   - [インポート](#インポート)
   - [エクスポート](#エクスポート)
   - [デプロイ](#デプロイ)
6. [監査ログ機能](#監査ログ機能)
   - [監査ログの閲覧](#監査ログの閲覧)
   - [変更の復元](#変更の復元)
7. [ページネーション](#ページネーション)

---

## 概要

Environment Properties Managerは、複数の環境とコンポーネントにまたがるアプリケーション設定を一元管理するためのツールです。プロパティの編集、バージョン管理、監査ログ、デプロイメント機能を提供します。

## 初期設定

### フォルダからの初期化

アプリケーションを初めて使用する際は、既存のプロパティファイルからデータを読み込む必要があります。

1. **Initializeボタンをクリック**
   - ヘッダーの「Initialize」ボタンをクリックします
   - フォルダ選択ダイアログが表示されます

2. **フォルダ構造の要件**
   ```
   選択フォルダ/
   ├── 環境名1/
   │   ├── env.properties
   │   ├── app-properties.properties
   │   └── その他のプロパティファイル
   ├── 環境名2/
   │   └── 同様の構造
   ```

3. **読み込み結果**
   - 成功メッセージが表示され、読み込まれたプロパティ数と環境が表示されます
   - 自動的にプロパティがグリッドに表示されます

## 基本機能

### プロパティの編集

既存のプロパティ値を編集する方法：

1. **セルをダブルクリック**
   - 編集したいセル（値、キー、説明）をダブルクリックします
   - セルが編集モードになり、背景色が薄い青色になります
   - 既存の値が自動的に全選択されます

2. **値の入力**
   - そのまま入力すると既存の値を置き換えます
   - 部分的に編集する場合は、矢印キーで選択を解除してから編集します
   - パスワードなどの機密情報は「***」として表示されますが、編集時は実際の値が表示されます

3. **編集の確定**
   - Enterキーを押すか、他のセルをクリックして編集を確定します
   - 編集されたセルは青い枠線で表示されます

4. **変更の保存**
   - 画面上部に「Save Changes」ボタンが表示されます
   - ボタンをクリックしてコメントダイアログで変更内容を記録します

### プロパティの追加

新しいプロパティを追加する方法：

1. **Add Propertyボタンをクリック**
   - 画面右上の「Add Property」ボタンをクリックします

2. **プロパティ情報の入力**
   - **Key**: プロパティのキー名（例：database.url）
   - **Value**: プロパティの値
   - **Description**: プロパティの説明（オプション）
   - **Environments**: 追加する環境を選択（複数選択可）

3. **保存**
   - 「Save」ボタンをクリックすると、プロパティが一時的に追加されます
   - 追加されたプロパティは緑色の背景で表示されます
   - 「Save Changes」ボタンをクリックして変更を確定します

### 環境の追加

新しい環境を追加する方法：

1. **コンポーネントを選択**
   - 特定のコンポーネントを選択します（「all」では追加できません）

2. **Add Environmentボタンをクリック**
   - 「Add Environment」ボタンをクリックします

3. **環境情報の入力**
   - **Environment Name**: 新しい環境名（例：staging）
   - **Copy Properties From**: 既存環境から値をコピー（オプション）

4. **追加の確認**
   - 追加される環境のプロパティが緑色で表示されます
   - 「Save Changes」ボタンで変更を確定します

### 環境の削除

環境を削除する方法：

1. **削除アイコンをクリック**
   - 環境列のヘッダーにある×アイコンをクリックします

2. **削除の確認**
   - 確認ダイアログで「OK」をクリックします
   - 削除対象のプロパティが赤色の背景と取り消し線で表示されます

3. **削除の実行**
   - 「Save Changes」ボタンをクリックして削除を確定します

### 変更の保存とキャンセル

#### 変更の保存

1. **Save Changesボタン**
   - 変更がある場合、画面上部に保存エリアが表示されます
   - 「Save Changes」ボタンをクリックします

2. **コメントの入力**
   - 変更内容の説明を入力します（自動生成されたコメントを編集可能）
   - 「Save Changes」をクリックして保存を実行します

3. **保存の確認**
   - プログレスインジケーターが表示されます
   - 成功メッセージが表示されます

#### 変更のキャンセル

- **Cancelボタン**
  - すべての変更を破棄して元の状態に戻します
  - 編集中、追加予定、削除予定のすべての変更がキャンセルされます

## フィルタリング機能

### コンポーネント切り替え

1. **コンポーネントセレクター**
   - 画面上部のドロップダウンからコンポーネントを選択します
   - 選択可能なオプション：
     - **all**: すべてのコンポーネントを表示
     - **個別コンポーネント**: 特定のコンポーネントのみ表示

2. **フィルタリング効果**
   - 選択したコンポーネントのプロパティのみが表示されます
   - ページネーションは自動的にリセットされます

### キーフィルター

1. **検索ボックス**
   - 「Filter by key...」に検索文字列を入力します
   - リアルタイムでフィルタリングが適用されます

2. **フィルタリング動作**
   - 部分一致検索
   - 大文字・小文字を区別しません
   - 検索をクリアするには入力を削除します

## データ管理機能

### フォルダからの初期化

前述の[初期設定](#初期設定)を参照してください。

### インポート

#### サポートされるファイル形式
- **.parquet.enc**: 暗号化された完全スナップショット
- **.parquet**: 非暗号化のParquetファイル
- **.properties**: 個別のプロパティファイル

#### インポート手順

1. **Importボタンをクリック**
   - ヘッダーの「Import」ボタンをクリックします

2. **ファイルを選択**
   - ファイル選択ダイアログでインポートするファイルを選択します

3. **パスワード入力**（暗号化ファイルの場合）
   - パスワード入力ダイアログが表示されます
   - 正しいパスワードを入力します

4. **インポート完了**
   - 成功メッセージが表示されます
   - データが自動的に読み込まれます

### エクスポート

完全なスナップショット（プロパティ＋監査ログ）をエクスポートする方法：

1. **Exportボタンをクリック**
   - ヘッダーの「Export」ボタンをクリックします

2. **エクスポートダイアログ**
   - エクスポートされる内容が表示されます：
     - すべてのプロパティ
     - 完全な監査履歴
     - 環境とコンポーネント設定

3. **パスワード設定**
   - 暗号化パスワードを入力します（必須）
   - パスワードは安全に保管してください

4. **ダウンロード**
   - 「Export Complete Snapshot」をクリックします
   - `.parquet.enc`ファイルがダウンロードされます

### デプロイ

プロパティファイルをデプロイ用にパッケージ化する方法：

1. **Deployボタンをクリック**
   - ヘッダーの「Deploy」ボタンをクリックします

2. **デプロイ内容の確認**
   - パッケージに含まれる内容：
     - 環境ごとに整理されたプロパティファイル
     - デプロイメントメタデータ
     - READMEファイル

3. **ダウンロード**
   - 「Deploy」ボタンをクリックします
   - ZIPファイルがダウンロードされます

4. **ZIPファイルの構造**
   ```
   deployment_YYYY-MM-DD.zip
   ├── README.md
   ├── environments/
   │   ├── production/
   │   │   ├── env.properties
   │   │   └── app-properties.properties
   │   └── staging/
   │       └── 同様の構造
   └── metadata.json
   ```

## 監査ログ機能

### 監査ログの閲覧

1. **Auditボタンをクリック**
   - ヘッダーの「Audit」ボタンをクリックします
   - 監査ログページが表示されます

2. **ログの内容**
   - **Timestamp**: 変更日時
   - **Action**: 操作種別（CREATE/UPDATE/DELETE/RESTORE/BATCH）
   - **Property**: プロパティキー
   - **Environment**: 環境名
   - **Component**: コンポーネント名
   - **Change Details**: 変更内容の詳細

3. **検索機能**
   - 検索ボックスでログをフィルタリングできます
   - キー、環境、コンポーネント、変更詳細で検索可能

4. **統計情報**
   - 総ログ数
   - アクション別の集計

### 変更の復元

1. **復元可能な操作**
   - **UPDATE**: 以前の値に戻す
   - **DELETE**: 削除されたプロパティを復元
   - **CREATE**: 作成されたプロパティを削除
   - **BATCH**: バッチ操作全体を元に戻す

2. **復元手順**
   - 復元したいログの「Restore」アイコンをクリックします
   - 確認ダイアログで復元内容を確認します
   - 「Restore」（または「Delete Property」）をクリックします

3. **バッチ操作の復元**
   - バッチ操作の詳細が表示されます
   - 各操作の復元内容が色分けして表示されます：
     - 🟨 更新の取り消し
     - 🟥 作成の削除
     - 🟩 削除の復元

4. **復元の確認**
   - メインページに戻り、成功メッセージが表示されます
   - 復元操作も監査ログに記録されます

## ページネーション

大量のプロパティを扱う際の表示制御：

1. **表示行数の切り替え**
   - 「Show all X rows」スイッチで全行表示を切り替えます
   - デフォルトは100行ずつ表示

2. **ページ移動**
   - ページネーションコントロールで前後のページに移動
   - 最初/最後のページへの直接ジャンプも可能

3. **パフォーマンス考慮**
   - 大量データの場合、全行表示は動作が遅くなる可能性があります
   - 必要に応じてページング表示を使用してください

---

## トラブルシューティング

### よくある問題

1. **初期化に失敗する**
   - フォルダ構造が正しいか確認してください
   - プロパティファイルの形式を確認してください

2. **インポートできない**
   - ファイル形式がサポートされているか確認してください
   - 暗号化ファイルの場合、正しいパスワードを入力してください

3. **変更が保存されない**
   - ネットワーク接続を確認してください
   - ブラウザのコンソールでエラーを確認してください

### サポート

問題が解決しない場合は、システム管理者にお問い合わせください。